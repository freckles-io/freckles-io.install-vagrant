---
# tasks to install vagrant

- name: "[calculating Vagrant download name]"
  set_fact:
    vagrant_binary_name: "{{ ansible_os_family | vagrant_binary_name_filter(vagrant_version, ansible_architecture) }}"

- name: creating cache download dir
  file:
    name: "{{ vagrant_download_path }}"
    state: directory
  when: ansible_os_family != "Darwin"

# errors out when 'validate_certs: true', needs to be fixed in ansible I think
- name: downloading Vagrant
  get_url:
    url: "{{ vagrant_download_url }}/{{ vagrant_version }}/{{ vagrant_binary_name }}"
    dest: "{{ vagrant_download_path }}/{{ vagrant_binary_name }}"
    validate_certs: false # temporary, until ansible fixes this
  become: no
  when: ansible_os_family != "Darwin"

# get_url errors out here, at least on El Capitain
# - name: download Vagrant
  # command: curl "{{ vagrant_download_url }}/{{ vagrant_version }}/{{vagrant_binary_name }}" --output "{{ vagrant_download_path }}/{{ vagrant_binary_name }}"
  # become: no
  # when: ansible_os_family == "Darwin"

- include: debian.yml
  when: ansible_os_family == "Debian"

- include: redhat.yml
  when: ansible_os_family == "RedHat"

- include: darwin.yml
  when: ansible_os_family == "Darwin"

- name: deleting downloaded Vagrant install package
  file:
    name: "{{ vagrant_download_path }}/{{ vagrant_binary_name }}"
    state: absent
  when: delete_download_after
